<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ezra's Space Adventure!</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            font-family: 'Courier New', monospace;
            color: #fff;
        }
        #gameCanvas {
            border: 3px solid #00ff00;
            background: #000;
            box-shadow: 0 0 20px #00ff00;
        }
        .info {
            margin-top: 20px;
            font-size: 18px;
            text-align: center;
        }
        .controls {
            margin-top: 10px;
            padding: 15px;
            background: #111;
            border: 2px solid #00ff00;
            border-radius: 10px;
        }
        .title {
            font-size: 32px;
            color: #00ff00;
            text-shadow: 0 0 10px #00ff00;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="title">ðŸ¤– EZRA'S SPACE ADVENTURE ðŸš€</div>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <div class="info">
        <div style="font-size: 24px; color: #00ff00; margin-bottom: 10px;"><span id="message">Welcome! Starting adventure...</span></div>
        <div>Dimension: <span id="dimension">1</span> | Power-Ups: <span id="powerups">0</span> | Score: <span id="score">0</span></div>
    </div>
    <div class="controls">
        <strong>Controls:</strong> Arrow Keys = Move | SPACEBAR = Shoot Magic
    </div>

    <script type="module">
        import { GameEngine } from './src/engine/GameEngine.js';
        import { Player } from './src/entities/Player.js';

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Initialize game engine
        const engine = new GameEngine();

        // Create player
        const player = new Player(400, 500);
        engine.addEntity(player);

        // Keyboard input
        const keys = {};
        window.addEventListener('keydown', (e) => {
            keys[e.key] = true;

            if (e.key === ' ') {
                e.preventDefault();
                // TODO: Fire weapon
            }
        });

        window.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        // Create stars
        const stars = [];
        for (let i = 0; i < 100; i++) {
            stars.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                size: Math.random() * 2,
                speed: Math.random() * 2 + 1
            });
        }

        // Game loop
        let lastTime = 0;
        function gameLoop(currentTime) {
            const deltaTime = (currentTime - lastTime) / 16.67; // Normalize to 60fps
            lastTime = currentTime;

            // Handle player input
            let vx = 0, vy = 0;
            if (keys['ArrowLeft']) vx = -player.speed;
            if (keys['ArrowRight']) vx = player.speed;
            if (keys['ArrowUp']) vy = -player.speed;
            if (keys['ArrowDown']) vy = player.speed;
            player.setVelocity(vx, vy);

            // Constrain player to canvas
            if (player.x < 0) player.x = 0;
            if (player.x > canvas.width - player.width) player.x = canvas.width - player.width;
            if (player.y < 0) player.y = 0;
            if (player.y > canvas.height - player.height) player.y = canvas.height - player.height;

            // Update engine
            engine.update(deltaTime);

            // Update stars
            stars.forEach(star => {
                star.y += star.speed * deltaTime;
                if (star.y > canvas.height) {
                    star.y = 0;
                    star.x = Math.random() * canvas.width;
                }
            });

            // Render
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw stars
            stars.forEach(star => {
                ctx.fillStyle = '#fff';
                ctx.fillRect(star.x, star.y, star.size, star.size);
            });

            // Draw entities
            engine.state.entities.forEach(entity => {
                entity.render(ctx);
            });

            // Update UI
            document.getElementById('powerups').textContent = player.powerups;
            document.getElementById('score').textContent = engine.state.score;

            requestAnimationFrame(gameLoop);
        }

        // Start game
        engine.start();
        requestAnimationFrame(gameLoop);
    </script>
</body>
</html>
